import request from 'graphql-request'
import type { GetStaticProps, NextPage } from 'next'
import Head from 'next/head'
import Link from 'next/link'
import { useAccount } from '../../contexts/AccountContext'

const Home: NextPage = () => {
  const account = useAccount()
  return (
    <div>
      <Head>
        <title>{account?.friendlyName}</title>
        <meta name='description' content='Generated by create next app' />
      </Head>
      <h1>Seja bem-vindo {account?.friendlyName}</h1>
      <p>
        <Link href='/devpleno/sobre'>
          <a>Sobre</a>
        </Link>
      </p>
    </div>
  )
}

export async function getStaticPaths() {
  return { paths: [], fallback: 'blocking' }
}

export const getStaticProps: GetStaticProps = async (context) => {
  const slug = context?.params?.slug
  const { account } = await request(
    'https://api.learn49.com/graphql',
    `
  query{
    account: getAccountSettingsByDomain(domain: "${slug}.learn49.com"){
      id
      friendlyName
    }
  }`
  )
  return {
    props: {
      account
    },
    revalidate: 60
  }
}

export default Home
